<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/public/img/favicon.ico">
    <title>6th BAND - Rental</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="/public/css/common.css">
    <style>
        .fw-600 {
            font-weight: 600;
        }

        .fw-500 {
            font-weight: 500;
        }

        .btn-outline-secondary {
            background-color: transparent !important;
            color: #5d5d5d !important;
            border-color: #afafaf !important;
            transition: background-color 0.3s ease;
        }

        .btn-outline-secondary:hover {
            background-color: rgba(0, 0, 0, 0.6);
            color: #9f9f9f;
            border-color: #afafaf;
        }
    </style>
</head>
<body>
<div id="root">
    <div class="wrapper">
        <!-- /* 헤더 */ -->
        <div th:replace="~{common/navi::topNavi}"></div>
        <div th:replace="~{common/navi::allMenuNavi}"></div>

        <!-- /* 컨텐츠 */ -->
        <div class="main">
            <!--배너 sec-->
            <div class="container">
                <div class="row">
                    <div class="col ps-0 pe-0">
                        <a th:href="@{/rental/list}">
                            <img th:src="@{/public/img/rental/rental_banner.png}" class="image-thumbnail" alt="렌탈배너">
                        </a>
                    </div>
                </div>
            </div>

            <!--Top4 sec-->
            <div class="container">
                <div class="row new-pt-45 d-flex align-items-center">
                    <div class="col-9 fs-5 fw-600">
                        <span>가장 많이 대여한 상품 Top4</span>
                    </div>
                    <div class="col-3 pe-1 d-flex align-items-center justify-content-end">
                        <a href="/rental/list" class="d-flex align-items-center">
                            <div class="pe-0 new-fs-85 text-end new-text-light-gray">더보기</div>
                            <div class="ps-0 pe-0">
                                <span class="material-symbols-outlined new-text-light-gray new-fw-thin d-flex align-items-center">
                                    chevron_right
                                </span>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="row pt-1">
                    <div class="col new-fs-9">
                        <span>페스티벌을 완성할 최고의 대여 상품을 만나보세요!</span>
                    </div>
                </div>
                <div class="row pt-2 new-pb-45 new-text-black new-fs-85 fw-500 border-bottom">
                    <div class="col-6" th:each="item : ${topItems}">
                        <a th:href="@{/rental/details(id=${item.id})}" class="d-block text-decoration-none text-reset">
                            <img class="img-fluid" th:src="@{/images/{image}(image=${item.image})}" alt="상품 이미지">
                            <div class="row pt-1">
                                <div class="col ellipsis-line-one">
                                    <span th:text="${item.title}">상품명</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col mb-2">
                                    <span class="font-roboto" th:text="${#numbers.formatDecimal(item.price, 0, 'COMMA', 0, 'POINT')}"></span>원
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

            <!--여름 페스티벌 sec-->
            <div class="container">
                <div class="row new-pt-45 d-flex align-items-center">
                        <div class="col-9 fs-5 fw-600">
                            <span>당신을 위한 대여 상품</span>
                        </div>
                    <div class="col-3 pe-1 d-flex align-items-center justify-content-end">
                        <a href="/rental/list" class="d-flex align-items-center">
                            <div class="pe-0 new-fs-85 text-end new-text-light-gray">더보기</div>
                            <div class="ps-0 pe-0">
                            <span class="material-symbols-outlined new-text-light-gray new-fw-thin d-flex align-items-center">
                                chevron_right
                            </span>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="row pt-1">
                    <div class="col new-fs-9">
                        <span>여름 페스티벌을 빛내줄 대여 상품을 지금 확인하세요.</span>
                    </div>
                </div>
                <!--
                <div class="row pt-2">
                    <div class="col">상품 이미지
                        <div class="row">
                            <div class="col">상품명</div>
                        </div>
                        <div class="row">
                            <div class="col">가격</div>
                        </div>
                    </div>
                    <div class="col">상품 이미지
                        <div class="row">
                            <div class="col">상품명</div>
                        </div>
                        <div class="row">
                            <div class="col">가격</div>
                        </div>
                    </div>
                </div>
                -->
            </div>

            <!-- Carousel 시작 -->
            <div id="carouselExampleAutoplaying" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner" id="carouselInner">
                    <!-- 첫 번째 슬라이드 -->
                    <div class="carousel-item active">
                        <div class="row">
                            <div class="col">
                                <a th:href="@{/rental/details(id=${topLikedItems[0].id})}">
                                    <img th:src="@{/images/{image}(image=${topLikedItems[0].image})}" class="d-block w-100" alt="상품 이미지">
                                </a>
                                <div class="carousel-caption d-none d-md-block">
                                    <h5 th:text="${topLikedItems[0].title}">상품명</h5>
                                    <p th:text="${topLikedItems[0].price}">가격</p>
                                </div>
                            </div>
                            <div class="col">
                                <a th:href="@{/rental/details(id=${topLikedItems[1].id})}">
                                    <img th:src="@{/images/{image}(image=${topLikedItems[1].image})}" class="d-block w-100" alt="상품 이미지">
                                </a>
                                <div class="carousel-caption d-none d-md-block">
                                    <h5 th:text="${topLikedItems[1].title}">상품명</h5>
                                    <p th:text="${topLikedItems[1].price}">가격</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 두 번째 슬라이드 -->
                    <div class="carousel-item">
                        <div class="row">
                            <div class="col">
                                <a th:href="@{/rental/details(id=${topLikedItems[2].id})}">
                                    <img th:src="@{/images/{image}(image=${topLikedItems[2].image})}" class="d-block w-100" alt="상품 이미지">
                                </a>
                                <div class="carousel-caption d-none d-md-block">
                                    <h5 th:text="${topLikedItems[2].title}">상품명</h5>
                                    <p th:text="${topLikedItems[2].price}">가격</p>
                                </div>
                            </div>
                            <div class="col">
                                <a th:href="@{/rental/details(id=${topLikedItems[3].id})}">
                                    <img th:src="@{/images/{image}(image=${topLikedItems[3].image})}" class="d-block w-100" alt="상품 이미지">
                                </a>
                                <div class="carousel-caption d-none d-md-block">
                                    <h5 th:text="${topLikedItems[3].title}">상품명</h5>
                                    <p th:text="${topLikedItems[3].price}">가격</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 세 번째 슬라이드 -->
                    <div class="carousel-item">
                        <div class="row">
                            <div class="col">
                                <a th:href="@{/rental/details(id=${topLikedItems[4].id})}">
                                    <img th:src="@{/images/{image}(image=${topLikedItems[4].image})}" class="d-block w-100" alt="상품 이미지">
                                </a>
                                <div class="carousel-caption d-none d-md-block">
                                    <h5 th:text="${topLikedItems[4].title}">상품명</h5>
                                    <p th:text="${topLikedItems[4].price}">가격</p>
                                </div>
                            </div>
                            <div class="col">
                                <a th:href="@{/rental/details(id=${topLikedItems[5].id})}">
                                    <img th:src="@{/images/{image}(image=${topLikedItems[5].image})}" class="d-block w-100" alt="상품 이미지">
                                </a>
                                <div class="carousel-caption d-none d-md-block">
                                    <h5 th:text="${topLikedItems[5].title}">상품명</h5>
                                    <p th:text="${topLikedItems[5].price}">가격</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
            <!-- Carousel 끝 -->
        </div>

        <!-- /* 푸터 */ -->
        <div th:replace="~{common/navi::bottomNavi}"></div>
        <!--/* 퀵바 */-->
        <div th:replace="~{common/navi::quickNavi}"></div>
    </div>
</div>

<!--/* 사이드바 */-->
<div th:replace="~{common/navi::sidebarLeft}"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const urlParams = new URL(window.location.href).searchParams;
    const rentalItemId = urlParams.get("id");
    let myId = null;

    function setSessionId(){
        const url = "/api/rental/getSessionUserId";
        fetch(url)
            .then(response => response.json())
            .then((response) => {
                if (response.data && response.data.userInfo) {
                    myId = response.data.userInfo.id;
                    console.log("로그인된 사용자 ID:", myId);
                } else {
                    myId = null;
                    console.log("사용자가 로그인하지 않았습니다.");
                }
            })
            .catch(error => console.error('Error:', error));
    }

    document.addEventListener("DOMContentLoaded", function() {
        setSessionId();

        // TopLikedItems 가져와서 Carousel에 추가
        fetch("/api/rental/getTopLikedItems")
            .then(response => response.json())
            .then(response => {
                console.log(response.data.topLikedItems);
                if(response.result === "success") {
                    const topLikedItems = response.data.topLikedItems;
                    if (topLikedItems && topLikedItems.length >= 6) {  // 배열의 길이 및 null 체크
                        const carouselInner = document.getElementById("carouselInner");

                        // 기존 슬라이드 비우기
                        carouselInner.innerHTML = '';

                   for(let i = 0; i < topLikedItems.length; i += 2) {
                        const slide = document.createElement("div");
                        slide.className = `carousel-item ${i === 0 ? "active" : ""}`;
                        slide.innerHTML =  `
                           <div class="container">
                               <div class="row pt-2">
                                   <div class="col">
                                       <a href="/rental/details?id=${topLikedItems[i].id}" class="d-block text-decoration-none text-reset">
                                           <img src="/images/${topLikedItems[i].image}" class="d-block w-100" alt="상품 이미지">
                                           <div class="mt-2 new-text-black fw-500 new-fs-9">
                                               <div class="row">
                                                   <div class="col ellipsis-line-one">
                                                       <span>${topLikedItems[i].title}</span>
                                                   </div>
                                               </div>
                                               <div class="row">
                                                   <div class="col">
                                                       <p>${topLikedItems[i].price.toLocaleString()} 원</p>
                                                   </div>
                                               </div>
                                           </div>
                                       </a>
                                   </div>
                                   ${topLikedItems[i + 1] ? `
                                   <div class="col">
                                       <a href="/rental/details?id=${topLikedItems[i + 1].id}" class="d-block text-decoration-none text-reset">
                                           <img src="/images/${topLikedItems[i + 1].image}" class="d-block w-100" alt="상품 이미지">
                                           <div class="mt-2 new-text-black fw-500 new-fs-9">
                                               <div class="row">
                                                   <div class="col ellipsis-line-one">
                                                       <span>${topLikedItems[i + 1].title}</span>
                                                   </div>
                                               </div>
                                               <div class="row">
                                                   <div class="col">
                                                       <p>${topLikedItems[i + 1].price.toLocaleString()} 원</p>
                                                   </div>
                                               </div>
                                           </div>
                                       </a>
                                   </div>` : ""}
                               </div>
                           </div>
                        `;

                       carouselInner.appendChild(slide);
                   }
                }
                } else {
                    console.error("Not enough items in topLikedItems array");
                }
            })
            .catch(error => console.error("Error fetching top liked items:", error));
    });
</script>
</body>
</html>