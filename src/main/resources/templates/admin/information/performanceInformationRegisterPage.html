<!DOCTYPE html><html lang="ko" xmlns:th="http://www.thymeleaf.org"><head>    <meta charset="utf-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>6th band</title>    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />    <link rel="stylesheet" href="/public/css/common.css">    <link rel="stylesheet" href="/public/css/information/information.css"></head><script>    const urlParams = new URL(window.location.href).searchParams;    const festivalId = urlParams.get("id");    const festivalUrl = "/api/information/festivalLineupRegister?id=" + festivalId;    console.log(festivalId);    console.log(festivalUrl);    let StartingDate;    let EndDate;    function getFestivalDetailForLineUp(){        fetch(festivalUrl)            .then(response => response.json())            .then(response =>{                const e = response.data.festivalData;                const festivalName = document.getElementById("festivalName");                    festivalName.innerText = e.festivalDetail.festival_name;                const festivalStartingDate = document.getElementById("festivalStartingDate");                    festivalStartingDate.innerText = addNineHours(e.festivalDetail.starting_date).toISOString().split('T')[0];                const festivalEndDate = document.getElementById("festivalEndDate");                    festivalEndDate.innerText = addNineHours(e.festivalDetail.end_date).toISOString().split('T')[0];                // 시작일과 종료일을 타임스탬프에서 날짜 문자열로 변환한 뒤 date값에 설정해주고 최대값과 최소값 설정해줌...                StartingDate = addNineHours(e.festivalDetail.starting_date).toISOString().split('T')[0];                EndDate = addNineHours(e.festivalDetail.end_date).toISOString().split('T')[0];            })            .catch(error => {                console.error('Error fetching festival data:', error);            });    }    //페스티벌 아이디와 아티스트 아이디 둘 다가져오기 + 퍼포먼스 아이디도 같이 넣어줘야함    function getArtistListForLineUp(){        fetch(festivalUrl)            .then(response => response.json())            .then(response =>{                const artistListBox = document.getElementById("artistListBox");                artistListBox.innerHTML = "";                //id가 templete인 곳의 값을 여기로 대체시켜주겠다.                const artistWrapperTemplete = document.querySelector("#templete .artistListWrapper");                //틀 반복문 돌려주기                for(e of response.data.artistList){                    const newArtistWrapper = artistWrapperTemplete.cloneNode(true);                    //insert value값 받아오는 식...                    const artistId = newArtistWrapper.querySelector(".artistId");                    artistId.value = e.artistDto.id;                    const artistName = newArtistWrapper.querySelector(".artistName");                    artistName.innerText = e.artistDto.artist_name;                    const artistThumbnail = newArtistWrapper.querySelector(".artistThumbnail");                    artistThumbnail.src = '/images/' + e.artistDto.thumbnail;                    // 각 아티스트 ID에 대해 URL을 생성하고 API 호출                    const artistUrl = `/api/information/getIsRegister?id=${festivalId}&artistId=${e.artistDto.id}`;                    // 각 URL을 콘솔에 출력하여 확인합니다.                    // console.log('Artist URL:', artistUrl);                    fetch(artistUrl)                        .then(response=>{                            if(!response.ok){                                throw new Error('Network response was not ok')                            }return response.json();                        })                        .then(response =>{                            const isRegistered = response.data.isRegistered;                            if(isRegistered){                                artistId.disabled = true;                                //태그 안에 값을 설정해서 아예 넣어주는 것                                const statusMessage =document.createElement('span');                                statusMessage.innerText = '* 이미 등록이 완료된 아티스트입니다 ';                                // 날짜 정보 추가                                const performanceDate = document.createElement('span');                                if (response.data.RegisteredInformation && response.data.RegisteredInformation.performance_date) {                                    performanceDate.innerText = ` (날짜: ${response.data.RegisteredInformation.performance_date})`;                                    console.log("날짜정보 출력:", response.data.RegisteredInformation.performance_date);                                } else {                                    console.log("performance_date가 응답에 포함되지 않았습니다.");                                }                                // 요소 추가                                const artistStatusCol = newArtistWrapper.querySelector(".artistStatusCol");                                artistStatusCol.appendChild(statusMessage);                                artistStatusCol.appendChild(performanceDate);  // 날짜 정보 추가                            }                        })                        .catch(error => {                        console.error('Error fetching artist data:', error);                        artistId.disabled = true;  // 에러 발생 시에도 비활성화                        artistId.parentNode.appendChild(document.createTextNode(' (Error fetching data)'));                        });                    artistListBox.appendChild(newArtistWrapper);                }            })    }     function registerArtist(){        const registerArtist = document.getElementById('registerArtistForm');        const formData = new FormData(registerArtist);        //아 이걸 어떻게 넣어주냐... 드디어 넘겨줬다...        formData.append("performance_id",performanceId);        //퍼포먼스 아이디가 정의되지않음.        console.log('퍼포먼스 아이디2',performanceId);        //FormData의 구조는 List와 같아서 for문으로 뜯어줘야 데이터 확인이 가능함.        for(let key of formData.keys()){            console.log(key);        }        for(let value of formData.values()){            console.log(value);        }        const url = "/api/information/artistRegisterForLineUpProcess"        fetch(url,{            method:"post",            cache:"no-cache",            body: formData        })            .then(response => response.json())            .then(response => {                console.log("등록이 완료되었습니다.",response);            })            .catch(Error =>{                console.log("Error",Error);            })        alert("등록이 완료되었습니다.");        location.reload();    }    function registerDate(){        const dateInput = document.getElementById('performance_date');        dateInput.min = StartingDate;        dateInput.max = EndDate;        console.log('startingDate',StartingDate);        console.log('endDate',EndDate);        const date = document.getElementById('performance_date').value;        //유효성 검사 : 입력한 날짜가 시작일과 종료일 사이에 있는지 확인        const minDate = new Date(document.getElementById('performance_date').min);        const maxDate = new Date(document.getElementById('performance_date').max);        const selectedDate = new Date(date);        if(selectedDate < minDate || selectedDate > maxDate){            alert('선택한 날짜가 범위를 벗어났습니다. 다시 선택해주세요.');            return;        }        if(!date){            alert('선택된 날짜가 없습니다. 다시 선택해주세요.');            return;        }        //formData.append() 메서드는 파일이나 데이터를 FormData 객체에 첨부하여        //서버로 전송하기 위한 준비를 하는 과정... submit은 forData로...        //7/16 백단에 데이트 형식 지정안해줘서 안들어갔음. DateFormat 형식 잘 지정해주기        const url = "/api/information/festivalDateRegister"        fetch(url,{            method:"post",            headers :{                "Content-Type" : "application/x-www-form-urlencoded"            },            body : `festival_id=${festivalId}&performance_date=${date}`        })            .then(response => response.json())            .then(response => {                console.log('Success', response);            })            .catch(Error =>{                console.log('Error', Error);            });        reloadDateList();    }    //추가된 날짜 불러오기    function reloadDateList(){        const url = "/api/information/festivalLineupRegister?id=" + festivalId;        fetch(url)            .then(response => response.json())            .then(response =>{                loadDateList();            })    }    function loadDateList(){        fetch(festivalUrl)            .then(response => response.json())            .then(response => {                const dateListBox = document.getElementById("dateListBox");                dateListBox.innerHTML = "";                //아이디가 templete인 값에서 class가 dateWrapper인 한덩어리의 html을 복사하겠다. 구조를 모르면 못씀                const dateWrapperTemplete = document.querySelector("#templeteDate .dateWrapper");                for (e of response.data.PerformanceDate) {                    const newDateWrapper = dateWrapperTemplete.cloneNode(true);                    const dateDetail = newDateWrapper.querySelector(".festivalDate");                    dateDetail.innerText = formatFestival(addNineHours(e.festivalDate.performance_date));                    const registerLineup = newDateWrapper.querySelector(".registerLineup");                    registerLineup.value = e.festivalDate.id;                    //퍼포먼스 아이디에 id값을 넣어주고 아티스트 등록할때 formDate의 performanceId로 넘겨줌..                    // 추가된 부분: dataset.id에 값을 설정, 이 부분이 설정되지 않아서 performanceID 값이 들어가지 않는 이슈였음.                    //registerLinup의 id 태그에 해당 value를 넣어서 넘기는 거라고 해석하면 된다.                    const deleteLineup = newDateWrapper.querySelector(".deleteLineup");                    deleteLineup.href = "/api/information/deleteLinupAndDateByDateid?id=" + e.festivalDate.id;                    /**                     * async function(event): 클릭 이벤트 핸들러를 async 함수로 정의하여 await를 사용할 수 있게 합니다.                     *    2.	await fetch(deleteUrl, { method: 'DELETE' }): fetch 요청을 보내고 응답을 기다립니다.                     *    3.	if (response.ok): 요청이 성공했는지 확인하고, 성공하면 window.location.href를 설정하여 리다이렉트합니다.                     *    4.	catch (error): 요청 중 오류가 발생하면 콘솔에 오류 메시지를 출력합니다.                     *                     * 이 방법을 사용하면 두 개의 fetch 요청을 순차적으로 처리할 수 있으며, 코드의 가독성과 유지 보수성을 높일 수 있습니다.                     */                    deleteLineup.onclick = async function () {                        event.preventDefault(); // 링크의 기본 동작 방지                        const deleteUrl = deleteLineup.href;                        //그러니까 패치안에 패치가 가능하냐고..?                        //대신, 여러 비동기 작업을 순차적으로 처리해야 할 경우,                        //Promise 체인 또는 async/await 구문을 사용하는 것이 더 좋습니다.                        //이는 코드의 가독성을 높이고, 오류 처리를 쉽게 합니다.                        try {                            const response = await fetch(deleteUrl, {                                method: 'DELETE'                            });                            if (response.ok) {                                // 요청이 성공하면 리다이렉트                                window.location.href = "/admin/information/registerPerformanceDate?id=" + festivalId;                            } else {                                // 요청이 실패하면 에러 메시지 출력                                console.error('삭제 요청 실패');                            }                        } catch (error) {                            console.error('삭제 요청 중 오류 발생:', error);                        }                    }                    registerLineup.dataset.id = e.festivalDate.id;                    registerLineup.onclick = function () {                        performanceId = registerLineup.dataset.id;                        console.log('공연아이디 출력', performanceId);                    }                    dateListBox.appendChild(newDateWrapper);                }            })    }    // //이 부분은 .custom-checkbox 클래스를 가진 모든 요소를 선택합니다.    // //querySelectorAll 메서드는 이러한 요소들의 NodeList(노드 리스트)를 반환합니다.    // //forEach 메서드는 NodeList의 각 요소에 대해 주어진 함수를 실행합니다.    // // 여기서는 item이 .custom-checkbox 클래스를 가진 각각의 요소를 의미합니다.    // document.querySelectorAll('.custom-checkbox').forEach(item => {    //     //각 item에 클릭 이벤트 리스너를 추가합니다. 사용자가 .custom-checkbox 요소를 클릭할 때마다, 지정된 함수가 실행됩니다.    //     item.addEventListener('click', function() {    //         //this는 클릭된 .custom-checkbox 요소를 가리킵니다.    //         // previousElementSibling은 클릭된 요소의 이전 형제 요소를 선택합니다.    //         // 이 예제에서는 클릭된 .custom-checkbox 요소 바로 앞에 실제 체크박스(input[type="checkbox"])가 있다고 가정합니다.    //         var checkbox = this.previousElementSibling;    //         //체크박스의 checked 속성을 현재 값의 반대로 설정합니다. 즉, 체크박스가 체크되어 있으면 체크 해제하고, 체크되어 있지 않으면 체크합니다.    //         checkbox.checked = !checkbox.checked;    //     });    // });    document.querySelectorAll('.custom-checkbox').forEach(item => {        item.addEventListener('click', function() {            var checkbox = this.previousElementSibling;            checkbox.checked = !checkbox.checked;            // 체크 상태에 따라 클래스 추가 또는 제거            if (checkbox.checked) {                this.classList.add('checked');            } else {                this.classList.remove('checked');            }            // 선택한 날짜나 퍼포먼스 번호 출력            const selectedDate = document.getElementById('performance_date').value;            if (checkbox.checked) {                console.log('선택된 날짜:', selectedDate);                console.log('선택된 퍼포먼스 번호:', performanceId);                alert(`선택한 날짜: ${selectedDate}\n선택한 퍼포먼스 번호: ${performanceId}`);            }        });    });    // 타임스탬프에 9시간을 더하는 함수    function addNineHours(dateString) {        const newDate = new Date(dateString);        newDate.setHours(newDate.getHours() + 9);        return newDate;    }    // 날짜를 원하는 형식으로 포맷팅하는 함수    function formatFestival(date) {        return date.toLocaleDateString('ko-KR', {            year: 'numeric',            month: '2-digit',            day: '2-digit'        });    }    function backToFestivalDetailPage(){        window.location.href="/admin/information/festivalDetailPage?id=" + festivalId;    }    //순차적으로 진행되는 언어라서 조심하고 해당 특성에 대해서 잘 숙지하기.    window.addEventListener("DOMContentLoaded",()=>{        getFestivalDetailForLineUp();        loadDateList();        getArtistListForLineUp();    })</script><style>    .form-control, .btn {        height: 38px; /* 원하는 높이로 설정 */        padding: 5px 10px; /* 패딩 조정 */    }    .form-group {        display: flex;        align-items: center;    }    .btn {        margin-left: 5px; /* 버튼 간의 간격 */    }    .announcement{        font-size: 0.9em;        color: #9f9f9f;    }    .custom-checkbox-label input[type="checkbox"]:checked + .custom-checkbox {        background-color:#FF6D96;    }</style><body><div class="admin-wrapper">    <div class="admin-container">        <div class="d-flex">            <!-- /* 좌측 메뉴 : 메뉴 추가될 경우 해당 navi 에 추가 필요 */ -->            <div class="page-left position-fixed top-0 bottom-0 border-end border-dark">                <div th:replace="~{common/adminNavi::leftMenuNavi}"></div>            </div>            <!-- /* 우측 컨텐츠 */ -->            <div class="page-right flex-grow-1">                <!-- /* 헤더 */ -->                <div th:replace="~{common/adminNavi::topNavi}"></div>                <!-- /* 컨텐츠 */ -->                <div class="main py-4 px-4">                    <div class="row">                        <div class="col">                            <div class="row new-mb-25">                                <!--여기서 hidden값으로 festival값 받아와서 같이 넣어줘야함-->                                <div class="col">                                    <h3>라인업 등록</h3>                                </div>                                <div class="col text-end" style="padding-right: 2em">                                    <button class="btn btn-outline-secondary rounded-0" onclick="backToFestivalDetailPage()">등록완료</button>                                </div>                            </div>                            <div class="row new-bg-gray border-top border-black new-mt-45" style="overflow: hidden">                                <div class="col py-1 fw-bold">                                    페스티벌 정보 및 일자                                </div>                            </div>                            <div class="row new-mb-45">                                <div class="col">                                    <div class="row border-bottom">                                        <div class="col-auto py-1 ps-2 border-end fw-medium">                                            행사이름                                        </div>                                        <div class="col" id="festivalName">                                            페스티벌 이름                                        </div>                                    </div>                                    <div class="row border-bottom">                                        <div class="col-auto py-1 ps-2 border-end fw-medium">                                            시작날짜                                        </div>                                        <div class="col" id="festivalStartingDate">                                            팔로워 수                                        </div>                                    </div>                                    <div class="row border-bottom">                                        <div class="col-auto py-1 ps-2 border-end  fw-medium">                                            종료날짜                                        </div>                                        <div class="col" id="festivalEndDate">                                            종료날짜                                        </div>                                    </div>                                </div>                            </div>                        </div>                    </div>                    <!--form 시작, 여기 라인업페이지임. form 대신 이벤트 생성으로 걸어둠-->                    <div class="row">                        <div class="col new-bg-gray border-top border-black fw-bold py-1">                            날짜 등록                        </div>                    </div>                        <div class="row new-mt-45">                            <div class="col" style="overflow: hidden">                                <form id="registerDateForm" class="d-flex justify-content-center">                                    <div class="form-group">                                        <input type="date" name="performance_date" id="performance_date" class="form-control d-inline-block w-auto rounded-0">                                        <input onclick="registerDate()" type="button" class="btn btn-outline-secondary rounded-0" value="날짜등록하기">                                    </div>                                </form>                                <div class="row new-mt-25">                                    <div class="col announcement text-center">                                        * 한번 등록된 라인업은 수정이 어렵습니다. 페스티벌 일자 날짜 및 전달받은 데이터 확인 후 기입 바랍니다.                                    </div>                                </div>                                <div class="row mt-1">                                    <div class="col announcement text-center">                                        *날짜를 등록하면 해당 페스티벌에 참가할 등록된 아티스트 내역을 확인하실 수 있습니다.                                    </div>                                </div>                                <div class="row new-bg-gray border-top border-black new-mt-45" style="overflow: hidden">                                    <div class="col py-2 fw-bold">                                        등록된 날짜 및 라인업                                    </div>                                </div>                                <div class="row" >                                    <div class="col px-0 d-grid" id="dateListBox">                                    </div>                                </div>                                <div class="row d-none" id="templeteDate">                                    <div class="row dateWrapper mx-0">                                        <div class="col my-3 ">                                            <div class="row align-center">                                                <div class="col-auto festivalDate">                                                </div>                                                <div class="col text-end">                                                    <!-- Button trigger modal 모달을 표시하기 위한 트리거 역할을 한다.                                                     type="button": 버튼의 기본 동작을 설정합니다. (제출 버튼이 아님)                                                     class="btn btn-primary": Bootstrap 클래스입니다. 버튼에 기본적인 스타일을 적용합니다.                                                     data-bs-toggle="modal": Bootstrap의 데이터 속성으로, 버튼 클릭 시 모달을 열도록 설정합니다.                                                     data-bs-target="#exampleModal": 버튼이 클릭되었을 때 열릴 모달의 ID를 지정합니다. 여기서는 #exampleModal로 지정되어 있습니다.-->                                                    <button type="button"                                                            class="registerLineup btn btn-outline-secondary rounded-0"                                                            data-bs-toggle="modal"                                                            data-bs-target="#registerLineUp"                                                            value="registerLineup">라인업 등록하기</button>                                                    <a class="deleteLineup">                                                        <button class="btn btn-outline-secondary rounded-0">삭제</button>                                                    </a>                                                </div>                                            </div>                                            <div class="mt-2 border-bottom"></div>                                        </div>                                    </div>                                </div>                                <!--페스티벌 아이디 받아오는 곳-->                                <input type="hidden" value="id" >                            </div>                            <!-- Modal                            id="exampleModal": 모달의 ID입니다. 버튼의 data-bs-target 속성과 연결됩니다.                            <div class="modal-footer">: 모달의 하단에 위치하며, 주로 작업을 완료하거나 취소하는 버튼들이 위치합니다.                             -->                            <div class="modal fade" id="registerLineUp" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">                                <div class="modal-dialog">                                    <div class="modal-content">                                        <div class="modal-header">                                            <h1 class="modal-title fs-5" id="exampleModalLabel">아티스트 등록</h1>                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>                                        </div>                                        <div class="modal-body">                                            <div class="row">                                                <div class="col">                                                    <!--반복될 아티스트 껍데기-->                                                    <form id="registerArtistForm">                                                        <div class="row">                                                            <div class="col" id="artistListBox">                                                            </div>                                                        </div>                                                        <!--버튼은 form 안의 반복문 밖에-->                                                        <div class="row p-2">                                                            <div class="col">                                                                <div class="modal-footer">                                                                    <button type="button" class="btn btn-outline-secondary rounded-0" data-bs-dismiss="modal">닫기</button>                                                                    <input type="button" onclick="registerArtist()" value="아티스트 등록하기" class="btn btn-outline-secondary rounded-0">                                                                </div>                                                            </div>                                                        </div>                                                    </form>                                                    <!--아티스트 등록-->                                                    <div class="row d-none">                                                        <div class="col" id="templete">                                                            <div class="row artistListWrapper">                                                                <div class="col">                                                                    <div class="row my-2">                                                                        <div class="col-1 d-flex justify-content-center align-items-center">                                                                            <label class="custom-checkbox-label">                                                                                <input class="artistId" name="artist_id" type="checkbox" style="display:none;">                                                                                <!-- Custom checkbox UI -->                                                                                <span class="custom-checkbox"></span>                                                                            </label>                                                                        </div>                                                                        <div class="col-2 d-flex justify-content-center align-items-center">                                                                            <img class="img-fluid artistThumbnail"/>                                                                        </div>                                                                        <div class="col artistName d-flex justify-content-center align-items-center"></div>                                                                    </div>                                                                    <div class="row">                                                                        <div class="col artistStatusCol new-text-gray d-flex justify-content-center align-items-center"></div>                                                                    </div>                                                                </div>                                                            </div>                                                        </div>                                                    </div>                                                </div>                                            </div>                                        </div>                                    </div>                                </div>                            </div>                    </div>                    <!-- /* 푸터 */ -->                    <div th:replace="~{common/adminNavi::bottomNavi}"></div>                </div>            </div>        </div>    </div> </div></div> <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script></body></html>